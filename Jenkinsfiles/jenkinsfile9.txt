pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }
        stage('Deploy') {
            steps {
                sh 'scp target/*.war user@prod-server:/path/to/webapps'
            }
        }
        stage('Log Aggregation') {
            steps {
                sh 'scp user@prod-server:/var/log/app/*.log ./logs/'
            }
        }
        stage('Log Analysis') {
            steps {
                script {
                    def logFiles = findFiles(glob: 'logs/*.log')
                    for (file in logFiles) {
                        sh "grep 'ERROR' ${file.path}"
                    }
                }
            }
        }
    }
}
